"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const mysql = require("mysql");
const env_1 = require("../util/env");
const { v4: uuid } = require('uuid');
var connection = mysql.createPool({
    host: env_1.getEnvVar('DB_HOST'),
    user: env_1.getEnvVar('DB_USER'),
    password: env_1.getEnvVar('DB_PASSWORD'),
    port: 3306,
    database: env_1.getEnvVar('DB_NAME'),
});
async function createPost(post) {
    if (!post.id)
        post.id = uuid();
    const { id, title, content } = post;
    try {
        const query = `INSERT INTO posts (id ,title, content) VALUES ('${id}' ,'${title}', '${content}')`;
        await new Promise((resolve, reject) => {
            connection.query(query, (err, data) => {
                if (err) {
                    return reject(err);
                }
                return resolve(data);
            });
        });
        return post;
    }
    catch (err) {
        console.log('MYSQL error: ', err);
        return null;
    }
}
exports.default = createPost;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLCtCQUErQjtBQUMvQixxQ0FBdUM7QUFFdkMsTUFBTSxFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUUsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7QUFFckMsSUFBSSxVQUFVLEdBQUcsS0FBSyxDQUFDLFVBQVUsQ0FBQztJQUNoQyxJQUFJLEVBQUUsZUFBUyxDQUFDLFNBQVMsQ0FBQztJQUMxQixJQUFJLEVBQUUsZUFBUyxDQUFDLFNBQVMsQ0FBQztJQUMxQixRQUFRLEVBQUUsZUFBUyxDQUFDLGFBQWEsQ0FBQztJQUNsQyxJQUFJLEVBQUUsSUFBSTtJQUNWLFFBQVEsRUFBRSxlQUFTLENBQUMsU0FBUyxDQUFDO0NBQy9CLENBQUMsQ0FBQTtBQUVGLEtBQUssVUFBVSxVQUFVLENBQUMsSUFBVTtJQUNsQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUU7UUFBRSxJQUFJLENBQUMsRUFBRSxHQUFHLElBQUksRUFBRSxDQUFDO0lBQy9CLE1BQU0sRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxHQUFHLElBQUksQ0FBQztJQUNwQyxJQUFJO1FBQ0YsTUFBTSxLQUFLLEdBQUcsbURBQW1ELEVBQUUsT0FBTyxLQUFLLE9BQU8sT0FBTyxJQUFJLENBQUM7UUFDbEcsTUFBTSxJQUFJLE9BQU8sQ0FBQyxDQUFDLE9BQU8sRUFBRSxNQUFNLEVBQUUsRUFBRTtZQUNwQyxVQUFVLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRSxDQUFDLEdBQUcsRUFBRSxJQUFJLEVBQUUsRUFBRTtnQkFDcEMsSUFBSSxHQUFHLEVBQUU7b0JBQ1AsT0FBTyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUE7aUJBQ25CO2dCQUNELE9BQU8sT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFBO1lBQ3RCLENBQUMsQ0FBQyxDQUFBO1FBQ0osQ0FBQyxDQUFDLENBQUE7UUFDRixPQUFPLElBQUksQ0FBQztLQUNiO0lBQUMsT0FBTyxHQUFHLEVBQUU7UUFDWixPQUFPLENBQUMsR0FBRyxDQUFDLGVBQWUsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUNsQyxPQUFPLElBQUksQ0FBQztLQUNiO0FBQ0gsQ0FBQztBQUVELGtCQUFlLFVBQVUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIG15c3FsIGZyb20gXCJteXNxbFwiO1xuaW1wb3J0IHsgZ2V0RW52VmFyIH0gZnJvbSBcIi4uL3V0aWwvZW52XCJcbmltcG9ydCB7IFBvc3QgfSBmcm9tIFwiLi8uLi90eXBlcy9cIlxuY29uc3QgeyB2NDogdXVpZCB9ID0gcmVxdWlyZSgndXVpZCcpO1xuXG52YXIgY29ubmVjdGlvbiA9IG15c3FsLmNyZWF0ZVBvb2woe1xuICBob3N0OiBnZXRFbnZWYXIoJ0RCX0hPU1QnKSxcbiAgdXNlcjogZ2V0RW52VmFyKCdEQl9VU0VSJyksXG4gIHBhc3N3b3JkOiBnZXRFbnZWYXIoJ0RCX1BBU1NXT1JEJyksXG4gIHBvcnQ6IDMzMDYsXG4gIGRhdGFiYXNlOiBnZXRFbnZWYXIoJ0RCX05BTUUnKSxcbn0pXG5cbmFzeW5jIGZ1bmN0aW9uIGNyZWF0ZVBvc3QocG9zdDogUG9zdCkge1xuICBpZiAoIXBvc3QuaWQpIHBvc3QuaWQgPSB1dWlkKCk7XG4gIGNvbnN0IHsgaWQsIHRpdGxlLCBjb250ZW50IH0gPSBwb3N0O1xuICB0cnkge1xuICAgIGNvbnN0IHF1ZXJ5ID0gYElOU0VSVCBJTlRPIHBvc3RzIChpZCAsdGl0bGUsIGNvbnRlbnQpIFZBTFVFUyAoJyR7aWR9JyAsJyR7dGl0bGV9JywgJyR7Y29udGVudH0nKWA7XG4gICAgYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgY29ubmVjdGlvbi5xdWVyeShxdWVyeSwgKGVyciwgZGF0YSkgPT4ge1xuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgcmV0dXJuIHJlamVjdChlcnIpXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc29sdmUoZGF0YSlcbiAgICAgIH0pXG4gICAgfSlcbiAgICByZXR1cm4gcG9zdDtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgY29uc29sZS5sb2coJ01ZU1FMIGVycm9yOiAnLCBlcnIpO1xuICAgIHJldHVybiBudWxsO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNyZWF0ZVBvc3Q7Il19